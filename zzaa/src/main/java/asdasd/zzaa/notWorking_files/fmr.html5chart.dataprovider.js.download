function SecurityDataRequest(){Request.call(this),this.extendedHours,this.frequency,this.delayedData,this.symbols=[],this.timePeriod,this.uuid,this.additionalParameters=[]}function SecurityDataResponse(){this._securityDataList=[],this._invalidSymbols=[],this._symbolsWithUnExpectedStatus=[]}function SecurityDataProvider(){this._dataProvider}function SecurityDataRequester(){}function SecurityDataDataSource(e,t,a,r){DataSource.call(this,r||GUID.generate()),this._timeScaleDataSource=e,this._extendedHourDatasource=t,this._requester=a,this.getSymbol()}function DigitalVolatilityActionProvider(){this._actions=[]}SecurityDataRequest.prototype=function(){function e(){return DateService.todayEST()}function t(e,t){for(var a=0;a<f.length;a++)if(f[a].period===e){var r=f[a].interval;return f[a].callback(t,r)}return t}function a(e){for(var t=0;t<h.length;t++)if(e===h[t].frequencyType)return h[t].barScale}function r(e,t){var a=Math.ceil(200*t.getInterval()/60/6.5),r=DateExtensions.addWorkdays(e,-Math.max(3,a));return r.setHours(0,0,0),r}function i(e,t){var a;1===t.getInterval()?a=3:5===t.getInterval()?a=6:10===t.getInterval()?a=12:15===t.getInterval()?a=16:30===t.getInterval()?a=32:60===t.getInterval()&&(a=58);var r=DateExtensions.addWorkdays(e,-a);return r.setHours(0,0,0),r}function o(e){return DateExtensions.addMonths(e,-12)}function n(e){return DateExtensions.addMonths(e,-24)}function s(e){return DateExtensions.addMonths(e,-60)}function c(e){return DateExtensions.addMonths(e,-96)}function u(e){return DateExtensions.addMonths(e,-204)}function l(e){return DateExtensions.addMonths(e,-204)}function d(e){return DateExtensions.addMonths(e,-480)}function m(e){return DateExtensions.addMonths(e,-480)}function y(){if(void 0===this.timePeriod||null===this.timePeriod)throw new UndefinedOrNullException("timePeriod");if(this.timePeriod===Fmr_Pwi_Commons_TimePeriod.Max)return new Date(1950,0,1);for(var e=this.getBarScale(),a=t(this.timePeriod,this.getEndDate()),r=e.getScale(),i=0;i<D.length;i++){var o=D[i];if(o.scaleType===r){var n=this.timePeriod===Fmr_Pwi_Commons_TimePeriod.Custom?o.callbackForSecondSelection:o.callback;return n(a,e)}}}function _(){if(void 0===this.timePeriod||null===this.timePeriod)throw new UndefinedOrNullException("timePeriod");if(this.getBarScale().isIntraday()){var t=e.call(this);return t.setHours(23,59,59),t}return e.call(this)}function S(){if(void 0===this.frequency||null===this.frequency)throw new UndefinedOrNullException("frequency");return a.call(this,this.frequency)}var h=[{frequencyType:Fmr_Pwi_Commons_FrequencyScale.OneMinute,barScale:new BarScale(Fmr_Pwi_Commons_BarScaleType.Minute,1)},{frequencyType:Fmr_Pwi_Commons_FrequencyScale.FiveMinutes,barScale:new BarScale(Fmr_Pwi_Commons_BarScaleType.Minute,5)},{frequencyType:Fmr_Pwi_Commons_FrequencyScale.TenMinutes,barScale:new BarScale(Fmr_Pwi_Commons_BarScaleType.Minute,10)},{frequencyType:Fmr_Pwi_Commons_FrequencyScale.FifteenMinutes,barScale:new BarScale(Fmr_Pwi_Commons_BarScaleType.Minute,15)},{frequencyType:Fmr_Pwi_Commons_FrequencyScale.ThirtyMinutes,barScale:new BarScale(Fmr_Pwi_Commons_BarScaleType.Minute,30)},{frequencyType:Fmr_Pwi_Commons_FrequencyScale.Hourly,barScale:new BarScale(Fmr_Pwi_Commons_BarScaleType.Minute,60)},{frequencyType:Fmr_Pwi_Commons_FrequencyScale.Daily,barScale:new BarScale(Fmr_Pwi_Commons_BarScaleType.Daily)},{frequencyType:Fmr_Pwi_Commons_FrequencyScale.Weekly,barScale:new BarScale(Fmr_Pwi_Commons_BarScaleType.Weekly)},{frequencyType:Fmr_Pwi_Commons_FrequencyScale.Monthly,barScale:new BarScale(Fmr_Pwi_Commons_BarScaleType.Monthly)},{frequencyType:Fmr_Pwi_Commons_FrequencyScale.Quarterly,barScale:new BarScale(Fmr_Pwi_Commons_BarScaleType.Quarterly)},{frequencyType:Fmr_Pwi_Commons_FrequencyScale.Yearly,barScale:new BarScale(Fmr_Pwi_Commons_BarScaleType.Yearly)}],D=[{scaleType:Fmr_Pwi_Commons_BarScaleType.Minute,callback:r,callbackForSecondSelection:i},{scaleType:Fmr_Pwi_Commons_BarScaleType.Daily,callback:o,callbackForSecondSelection:n},{scaleType:Fmr_Pwi_Commons_BarScaleType.Weekly,callback:s,callbackForSecondSelection:c},{scaleType:Fmr_Pwi_Commons_BarScaleType.Monthly,callback:u,callbackForSecondSelection:l},{scaleType:Fmr_Pwi_Commons_BarScaleType.Quarterly,callback:d,callbackForSecondSelection:m},{scaleType:Fmr_Pwi_Commons_BarScaleType.Yearly,callback:d,callbackForSecondSelection:m}],f=[{period:Fmr_Pwi_Commons_TimePeriod.OneDay,callback:DateExtensions.addWorkdays,interval:-1},{period:Fmr_Pwi_Commons_TimePeriod.TwoDays,callback:DateExtensions.addWorkdays,interval:-1},{period:Fmr_Pwi_Commons_TimePeriod.FiveDays,callback:DateExtensions.addWorkdays,interval:-4},{period:Fmr_Pwi_Commons_TimePeriod.TenDays,callback:DateExtensions.addWorkdays,interval:-9},{period:Fmr_Pwi_Commons_TimePeriod.OneMonth,callback:DateExtensions.addMonths,interval:-1},{period:Fmr_Pwi_Commons_TimePeriod.ThreeMonths,callback:DateExtensions.addMonths,interval:-3},{period:Fmr_Pwi_Commons_TimePeriod.SixMonths,callback:DateExtensions.addMonths,interval:-6},{period:Fmr_Pwi_Commons_TimePeriod.YearToDate,callback:DateExtensions.addMonths,interval:-12},{period:Fmr_Pwi_Commons_TimePeriod.OneYear,callback:DateExtensions.addMonths,interval:-12},{period:Fmr_Pwi_Commons_TimePeriod.TwoYears,callback:DateExtensions.addMonths,interval:-24},{period:Fmr_Pwi_Commons_TimePeriod.FiveYears,callback:DateExtensions.addMonths,interval:-60},{period:Fmr_Pwi_Commons_TimePeriod.TenYears,callback:DateExtensions.addMonths,interval:-120}],p=Object.create(Request.prototype);return p.getStartDate=y,p.getEndDate=_,p.getBarScale=S,p}(),SecurityDataRequest.prototype.constructor=SecurityDataRequest,SecurityDataResponse.prototype=function(){function e(){return this._securityDataList}function t(){return this._invalidSymbols}function a(){return this._symbolsWithUnExpectedStatus}return{getSecurityDataList:e,getInvalidSymbols:t,getSymbolsWithUnExpectedStatus:a}}(),SecurityDataResponse.prototype.constructor=SecurityDataResponse,SecurityDataProvider.prototype=function(){function e(e,t){e&&e(t)}function t(e){var t=new HistoricalDataRequest;t.symbols=e.symbols,t.scale=e.getBarScale(),t.startDate=e.getStartDate(),t.endDate=e.getEndDate(),t.extendedHours=e.extendedHours,t.delayedData=e.delayedData,t.host=e.host,t.productId=e.productId,t.template=e.template,t.uuid=e.uuid;for(var a=0;a<e.additionalParameters.length;a++)t.additionalParameters.push(e.additionalParameters[a]);return t}function a(e){for(var t=new SecurityDataResponse,a=e.getSecurityDataList(),r=e.getSecurityDataWithErrorList(),i=0;i<a.length;i++)t.getSecurityDataList().push(a[i]);for(i=0;i<r.length;i++){var o=r[i];o.exception.getErrorCode()===Fmr_Pwi_Commons_SecurityDataErrorCode.InvalidSymbol?t.getInvalidSymbols().push(r[i].symbol):t.getSymbolsWithUnExpectedStatus().push(r[i])}return t}function r(r,i,o){var n=this;return!r.symbols||r.symbols.length<=0?void e(o,new ApplicationException("request should have symbols information")):this._dataProvider?void n._dataProvider.requestData(t(r),function(e){i&&i(a(e))},function(t){e(o,t)}):void e(o,new ApplicationException("the historicalDataProvider should not be undefined"))}function i(e){this._dataProvider=e}function o(){return this._dataProvider}return{setHistoricalDataProvider:i,getHistoricalDataProvider:o,requestData:r}}(),SecurityDataProvider.prototype.constructor=SecurityDataProvider,SecurityDataRequester.prototype=function(){function e(e,t,a,r){var i=ObjectFactory.createInstance(SecurityDataRequest),o=this._configuration.HistoricalDataService.Uuid?this._configuration.HistoricalDataService.Uuid:"92e756bd-8e61-418b-a3a1-9a938c4c2cb0";return i.host=this._configuration.HistoricalDataService.Host,i.productId=this._configuration.HistoricalDataService.ProductId,i.uuid=o,i.template=this._configuration.HistoricalDataService.Template,i.extendedHours=r,i.timePeriod=t,i.frequency=a,i.delayedData=!this._configuration.HistoricalDataService.Uuid,"D"===this._configuration.HistoricalDataService.RealTimeFlag&&(i.delayedData=!0),"R"===this._configuration.HistoricalDataService.RealTimeFlag&&(i.delayedData=!1),i.symbols.push(e),i}function t(e){r.call(this,Fmr_Pwi_Commons_SecurityDataErrorCode.GenericError,e)}function a(e){var t,a,i=Fmr_Pwi_Commons_SecurityDataErrorCode.NoError;1===e.getSecurityDataList().length?(a=e.getSecurityDataList()[0],t=a.getSymbol(),a.bars.length<=0&&(i=Fmr_Pwi_Commons_SecurityDataErrorCode.NoData)):1===e.getInvalidSymbols().length?(t=e.getInvalidSymbols()[0],i=Fmr_Pwi_Commons_SecurityDataErrorCode.InvalidSymbol):1===e.getSymbolsWithUnExpectedStatus().length&&(t=e.getSymbolsWithUnExpectedStatus()[0].symbol,i=e.getSymbolsWithUnExpectedStatus()[0].exception.getErrorCode(),i!==Fmr_Pwi_Commons_SecurityDataErrorCode.EntitledInternational&&(i=Fmr_Pwi_Commons_SecurityDataErrorCode.InvalidData)),r.call(this,i,t,a)}function r(e,t,a){EventBus.trigger(this,"SecurityDataRequester:requestcompleted",{errorCode:e,symbol:t,securityData:a})}function i(r,i,o,n){var s=this;s._lastRequestId=GUID.generate();var c=s._lastRequestId,u=e.call(this,r,i,o,n);EventBus.trigger(this,"SecurityDataRequester:beforerequest",{request:u}),this._dataProvider.requestData(u,function(e){c===s._lastRequestId&&a.call(s,e)},function(e){c===s._lastRequestId&&t.call(s,r,e)}),EventBus.trigger(this,"SecurityDataRequester:afterrequest")}function o(e){this._configuration=e}function n(e){this._dataProvider=e}return{requestData:i,setConfiguration:o,setSecurityDataProvider:n}}(),SecurityDataRequester.prototype.constructor=SecurityDataRequester,SecurityDataDataSource.prototype=function(){function e(e,t,a,r){this._requester.requestData(e,t,a,r)}function t(e,t){var a=this._securityData;this._securityData=void 0,t.errorCode!==Fmr_Pwi_Commons_SecurityDataErrorCode.NoError&&t.errorCode!==Fmr_Pwi_Commons_SecurityDataErrorCode.NoData||(this._securityData=t.securityData),a!==this._securityData&&EventBus.trigger(this,"DataSource:datachanged")}function a(){return this._requesterEventRegistered||(this._requesterEventRegistered=!0,EventBus.on(this._requester,"SecurityDataRequester:requestcompleted",t,this)),this._symbol}function r(){return this._securityData}function i(e){e!==this._symbol&&(this._symbol=e)}function o(){this.clear(),DataSource.prototype.destroy.call(this)}function n(){this._securityData&&(this._securityData=void 0,EventBus.trigger(this,"DataSource:datachanged"))}function s(){var t=this._timeScaleDataSource.getTimeframe(),a=this._timeScaleDataSource.getFrequency(),r=this._extendedHourDatasource.getValue();void 0!==this._symbol&&e.call(this,this._symbol,t,a,r)}function c(){return this._requester}var u=Object.create(DataSource.prototype);return u.getSymbol=a,u.getSecurityData=r,u.setSymbol=i,u.destroy=o,u.clear=n,u.refresh=s,u.getSecurityDataRequester=c,u}(),SecurityDataDataSource.prototype.constructor=SecurityDataDataSource,DigitalVolatilityActionProvider.prototype=function(){function e(){return this._actions}function t(e){if(null!==e){var t=[];e.forEach(function(e){e.date=DateService.toESTTime(DateUtil.strToDate(e.date,"YYYY-MM-DD")),t.push(new DigitalVolatilityAction(e.title,e.date,e.icon))}),this._actions=t}}function a(e){if(0===this.getActions().length||e){var t=this;$.get("data/market_events.json").done(function(e){var a=e.events;t.setActions(a),r.call(t,!0)}).fail(function(){r.call(t,!1)})}else r.call(this)}function r(){EventBus.trigger(this,"DigitalVolatilityActionProvider:requestcompleted",{actions:this.getActions()})}return{getActions:e,setActions:t,requestData:a}}(),SecurityDataResponse.prototype.constructor=SecurityDataResponse;